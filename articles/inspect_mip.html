<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inspecting the errorlocate Mixed Integer Program • errorlocate</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Inspecting the errorlocate Mixed Integer Program">
<meta property="og:description" content="errorlocate">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">errorlocate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.9.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/inspect_mip.html">Inspecting the errorlocate Mixed Integer Program</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Find errors in data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/data-cleaning/errorlocate/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="inspect_mip_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Inspecting the errorlocate Mixed Integer Program</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/data-cleaning/errorlocate/blob/master/vignettes/inspect_mip.Rmd"><code>vignettes/inspect_mip.Rmd</code></a></small>
      <div class="hidden name"><code>inspect_mip.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/data-cleaning/errorlocate">errorlocate</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: validate</span></code></pre></div>
<div id="intro" class="section level2">
<h2 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h2>
<p>Errorlocate uses the linear, categorical and conditional rules from a rules set formulated with R package <a href="https://cran.r-project.org/package=validate"><code>validate</code></a>, to create a Mixed Integer Problem.</p>
<p>For most users the details of the translation are not relevant and hidden in <code>locate_errors</code>. Often the number of errors found and the processing time are much more relevant parameters.</p>
<p>In a few cases, you may run into a problems with your error localization problem:</p>
<ol style="list-style-type: lower-alpha">
<li>The processing time of (some of the records) of <code>locate_errors</code> is high.</li>
<li>
<code>locate_errors</code> missed an obvious error.</li>
<li>
<code>locate_errors</code> indicates that it did not find a valid solution (for some records) .</li>
</ol>
<p>Problem a. can be addressed by using the parallel argument of <code>locate_errors</code> (and <code>replace_errors</code>). Problem b can be due to that <code>error_locate</code> ignores non-linear rules, and therefore is not able to deduce the errors, because it only takes linear, categorical and conditional rules into a account.</p>
<p>There may also be problems with your rules set. Problems set may be mitigated by using the <a href="https://cran.r-project.org/package=validate"><code>validatetools</code></a> package that can detect conflicting and redundant rules and has methods to simplify your rule set.</p>
<p>If you want to dive deep into the mixed integer problem that is created by <code>error_locate</code> you can use the <code>inspect_mip</code> function.</p>
</div>
<div id="a-bit-of-theory" class="section level2">
<h2 class="hasAnchor">
<a href="#a-bit-of-theory" class="anchor"></a>A bit of theory</h2>
<p>In the following sections an example is given of how linear, categorical and conditional rules are written as Mixed Integer Problems. First let’s see how these rules in validator can be formally defined.</p>
</div>
<div id="formal-description" class="section level2">
<h2 class="hasAnchor">
<a href="#formal-description" class="anchor"></a>Formal description</h2>
<div id="rule-r_imathbfx" class="section level3">
<h3 class="hasAnchor">
<a href="#rule-r_imathbfx" class="anchor"></a>Rule <span class="math inline">\(r_i(\mathbf{x})\)</span>
</h3>
<p>Each translatable rule <span class="math inline">\(r_i(\mathbf{x})\)</span> can be written as a disjunction of atomic clauses <span class="math inline">\(C_i^j(x)\)</span>: it is a function <span class="math inline">\(r_i\)</span> that operates on (some of) the values of record <span class="math inline">\(\mathbf{x} = (x_1, \ldots, x_n)\)</span> and is <code>TRUE</code> (valid) or <code>FALSE</code> (not valid)</p>
<p><span class="math display">\[
r_i(\mathbf{x}) = \bigvee_j C_i^j(\mathbf{x})
\]</span></p>
<p>with each atomic clause:</p>
<p><span class="math display">\[
C_i^j(\mathbf{x}) = \left\{
  \begin{array}{l}
 \mathbf{a}^T\mathbf{x} \leq b \\
  \mathbf{a}^T\mathbf{x} = b \\
  x_j \in F_{ij}  \textrm{with } F_{ij} \subseteq D_j \\
  x_j \not\in F_{ij} \textrm{with } F_{ij} \subseteq D_j \\
  \end{array}
\right.
\]</span></p>
<p>Each linear, categorical or conditional rule <span class="math inline">\(r_i\)</span> can be written in this form.</p>
</div>
<div id="example-1" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu">validator</span><span class="op">(</span>example_1 <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">income</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">16</span><span class="op">)</span>
<span class="va">rules</span><span class="op">$</span><span class="fu">exprs</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; $example_1</span>
<span class="co">#&gt; !(income &gt; 0) | (age &gt;= 16)</span>
<span class="co">#&gt; attr(,"reference")</span>
<span class="co">#&gt; example_1 </span>
<span class="co">#&gt;         1</span></code></pre></div>
<p>So the rule <code>if (income &gt; 0) age &gt;= 16</code> can be written as (<code>income &lt;= 0</code> OR <code>age &gt;=16</code>)</p>
</div>
<div id="example-2" class="section level3">
<h3 class="hasAnchor">
<a href="#example-2" class="anchor"></a>Example 2</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu">validator</span><span class="op">(</span>example_2 <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">has_house</span> <span class="op">==</span> <span class="st">"yes"</span><span class="op">)</span> <span class="va">income</span> <span class="op">&gt;=</span> <span class="fl">1000</span><span class="op">)</span>
<span class="va">rules</span><span class="op">$</span><span class="fu">exprs</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; $example_2</span>
<span class="co">#&gt; !(has_house == "yes") | (income &gt;= 1000)</span>
<span class="co">#&gt; attr(,"reference")</span>
<span class="co">#&gt; example_2 </span>
<span class="co">#&gt;         1</span></code></pre></div>
<p>So the rule <code>if (has_house == "yes") income &gt;= 1000)</code> can be written as (<code>has_house != "yes"</code> OR <code>age &gt;=1000</code>)</p>
</div>
</div>
<div id="rule-system" class="section level2">
<h2 class="hasAnchor">
<a href="#rule-system" class="anchor"></a>Rule system:</h2>
<p>The rules form a system <span class="math inline">\(R(\mathbf{x})\)</span>:</p>
<p><span class="math display">\[
R(\mathbf{x}) = \bigwedge_i r_i
\]</span> which means that all rules <span class="math inline">\(r_i\)</span> must be valid. If <span class="math inline">\(R(\mathbf{x})\)</span> is true for record <span class="math inline">\(\mathbf{x}\)</span>, then the record is valid, otherwise one (or more) of the rules is violated.</p>
</div>
<div id="mixed-integer-programming-to-fh" class="section level2">
<h2 class="hasAnchor">
<a href="#mixed-integer-programming-to-fh" class="anchor"></a>Mixed Integer Programming to FH</h2>
<p>Each rule set <span class="math inline">\(R(\mathbf{x})\)</span> can be translated into a mip problem and solved.</p>
<p><span class="math display">\[
\begin{array}{r}
  \textrm{Minimize } f(\mathbf{x}) = 0; \\
  \textrm{s.t. }\mathbf{Rx} \leq \mathbf{d} \\
\end{array}
\]</span> - <span class="math inline">\(f(\mathbf{x})\)</span> is the (weighted) number of changed variable: <span class="math inline">\(\delta_i \in {0,1}\)</span></p>
<p><span class="math display">\[
f(\mathbf{x}) = \sum_{i=1}^N w_i \delta_i
\]</span></p>
<ul>
<li>
<p><span class="math inline">\(\mathbf{R}\)</span> contains rules:</p>
<ul>
<li><p><span class="math inline">\(\mathbf{R}_H(\mathbf{x}) \leq \mathbf{d}_H\)</span> that were specified with <code>validate</code>/<code>validator</code></p></li>
<li><p><span class="math inline">\(\mathbf{R}_0(\mathbf{x}, \mathbf{\delta}) \leq \mathbf{d}_0\)</span> : soft constraints that try fix the current record of <span class="math inline">\(\mathbf{x}\)</span> to the observed values.</p></li>
</ul>
</li>
</ul>
</div>
<div id="enter-inspect_mip" class="section level2">
<h2 class="hasAnchor">
<a href="#enter-inspect_mip" class="anchor"></a>Enter <code>inspect_mip</code>:</h2>
<div id="linear-rules" class="section level3">
<h3 class="hasAnchor">
<a href="#linear-rules" class="anchor"></a>Linear rules</h3>
<p>Most users will use the function <code>locate_errors</code> to find errors. The function <code>inspect_mip</code> works exactly same, except that it operates on just one record in stead of a whole <code>data.frame</code>. The result of <code>inspect_mip</code> is a mip object, that is not yet executed and can be inspected.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu">validator</span><span class="op">(</span> r1 <span class="op">=</span> <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">18</span>
                  , r2 <span class="op">=</span> <span class="va">income</span> <span class="op">&gt;=</span> <span class="fl">0</span>
                  <span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">35</span><span class="op">)</span>, income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="op">-</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span>
<span class="va">data</span>
<span class="co">#&gt;   age income</span>
<span class="co">#&gt; 1  12   2000</span>
<span class="co">#&gt; 2  35  -1000</span></code></pre></div>
<p>So we detect two errors in the dataset:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">confront</span><span class="op">(</span><span class="va">data</span>, <span class="va">rules</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   name items passes fails nNA error warning             expression</span>
<span class="co">#&gt; 1   r1     2      1     1   0 FALSE   FALSE   (age - 18) &gt;= -1e-08</span>
<span class="co">#&gt; 2   r2     2      1     1   0 FALSE   FALSE (income - 0) &gt;= -1e-08</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/locate_errors.html">locate_errors</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">rules</span><span class="op">)</span><span class="op">$</span><span class="va">errors</span>
<span class="co">#&gt;        age income</span>
<span class="co">#&gt; [1,]  TRUE  FALSE</span>
<span class="co">#&gt; [2,] FALSE   TRUE</span></code></pre></div>
<p>Lets inspect the first record</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect_mip.html">inspect_mip</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">rules</span><span class="op">)</span>
<span class="co">#&gt; Warning: Taking record 1, ignoring rest of the records...</span></code></pre></div>
<p>The <code>mip</code> object contains the mip problem before it is executed. We can inspect the lp problem, prior to solving it with <code>lpSolveApi</code> with</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># inspect the lp problem (prior to solving it with lpsolveAPI)</span>
<span class="va">lp</span> <span class="op">&lt;-</span> <span class="va">mip</span><span class="op">$</span><span class="fu">to_lp</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span></code></pre></div>
<pre><code>  Model name: errorlocate
                        age          income      .delta_age   .delta_income           
  Minimize                0               0  1.034738065908   1.05557686591           
  r1                     -1               0               0               0  &lt;=    -18
  r2                      0              -1               0               0  &lt;=      0
  age_ub                  1               0          -1e+07               0  &lt;=     12
  income_ub               0               1               0          -1e+07  &lt;=   2000
  age_lb                 -1               0          -1e+07               0  &lt;=    -12
  income_lb               0              -1               0          -1e+07  &lt;=  -2000
  Kind                  Std             Std             Std             Std           
  Type                 Real            Real             Int             Int           
  Upper                 Inf             Inf               1               1           
  Lower                -Inf            -Inf               0               0</code></pre>
<p>Validator rules <code>r1</code> and <code>r2</code> are encoded in two lines of the model. The values of the current record are encoded as soft constraints in <code>age_ub</code>, <code>age_lb</code>, <code>income_lb</code> and <code>income_ub</code>. These constraints try to fix the values of <code>age</code> at 12 and <code>income</code> at 2000, but can be violated, setting <code>.delta_age</code> or <code>.delta_income</code> to 1.</p>
<p>For large problems the lp problem can be written to disk for inspection</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span><span class="op">$</span><span class="fu">write_lp</span><span class="op">(</span><span class="st">"my_problem.lp"</span><span class="op">)</span></code></pre></div>
<p>Once we execute the mip project, the lp solver is executed on the problem:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">mip</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Extra arguments are passed through to <code>lpSolveAPI</code>. The result object contains several properties:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="co">#&gt; [1] "s"        "solution" "values"   "lp"       "adapt"    "errors"</span></code></pre></div>
<p><code>res$solution</code> indicates of a solution was found</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">solution</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p><code>res$s</code> indicates the <code>lpSolveAPI</code> status, what kind of solution was found.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">s</span>
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p><code>res$errors</code> indicates which fields/values are deemed erroneous:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">errors</span>
<span class="co">#&gt;    age income </span>
<span class="co">#&gt;   TRUE  FALSE</span></code></pre></div>
<p><code>res$values</code> contains the values for the valid solution that has been found by the lpsolver:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">values</span>
<span class="co">#&gt;           age        income    .delta_age .delta_income </span>
<span class="co">#&gt;            18          2000             1             0</span></code></pre></div>
<p>Note that the solver has found that setting <code>age</code> from 12 to 18 gives a valid solution. <code>.delta_age = 1</code> indicates that <code>age</code> contained an error.</p>
<p>The result object <code>res</code> also contains an <code>lp</code> object after optimization. This object can be further investigated using <code>lpSolveAPI</code> functions.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># lp problem after solving</span>
<span class="va">res</span><span class="op">$</span><span class="va">lp</span></code></pre></div>
<pre><code>  Model name: errorlocate
                        age          income      .delta_age   .delta_income           
  Minimize                0               0  1.034738065908   1.05557686591           
  age_ub                  1               0          -1e+07               0  &lt;=     12
  income_ub               0               1               0          -1e+07  &lt;=   2000
  income_lb               0              -1               0          -1e+07  &lt;=  -2000
  Kind                  Std             Std             Std             Std           
  Type                 Real            Real             Int             Int           
  Upper                 Inf             Inf               1               1           
  Lower                  18               0               0               0</code></pre>
<p>Note that the lp problem has been simplified. For example the single variable constraints,the lp problem/object after solving shows that the solver has optimized some of the rules: it has moved rule <code>r1</code> and <code>r2</code> into the <code>Lower boundary</code> conditions. It also removed <code>age_lb</code> because that was superfluous with respect to the boundary conditions.</p>
</div>
<div id="categorical-rule" class="section level3">
<h3 class="hasAnchor">
<a href="#categorical-rule" class="anchor"></a>Categorical rule</h3>
<p>In categorical rules, each category is coded in a separate column/mip variable: e.g. if we have a <code>working</code> variable, with two categories (“job”, “retired”), the mip problem is encoded as follows:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu">validator</span><span class="op">(</span> r1 <span class="op">=</span> <span class="va">working</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"job"</span>,<span class="st">"retired"</span><span class="op">)</span>                  <span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>working<span class="op">=</span><span class="st">"?"</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">working</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">?</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect_mip.html">inspect_mip</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">rules</span><span class="op">)</span>
<span class="va">mip</span><span class="op">$</span><span class="fu">to_lp</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>  Model name: errorlocate
                  working:?      working:job  working:retired   .delta_working      
  Minimize                0                0                0   1.149454332422      
  r1                      0                1                1                0  =  1
  working                 1                0                0                1  =  1
  Kind                  SOS              SOS              SOS              Std      
  Type                  Int              Int              Int              Int      
  Upper                   1                1                1                1      
  Lower                   0                0                0                0</code></pre>
<p>Row <code>r1</code> indicates that either <code>working:job</code> or <code>working:retired</code> must be true. The <code>Kind</code> row (<code>SOS</code>) indicates that these variables share the same switch, only one of them can be set.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">values</span>
<span class="co">#&gt;       working:?     working:job working:retired  .delta_working </span>
<span class="co">#&gt;               0               1               0               1</span></code></pre></div>
<div id="multiple-categories" class="section level4">
<h4 class="hasAnchor">
<a href="#multiple-categories" class="anchor"></a>Multiple categories:</h4>
<p>With categorical variables it is also possible to specify <code>if-then</code> rules. These are encoded as one mip rule:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu">validator</span><span class="op">(</span> r1 <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">voted</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="va">adult</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>voted <span class="op">=</span> <span class="cn">TRUE</span>, adult <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">voted</th>
<th align="left">adult</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">TRUE</td>
<td align="left">FALSE</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect_mip.html">inspect_mip</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">rules</span><span class="op">)</span>
<span class="va">mip</span><span class="op">$</span><span class="fu">to_lp</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>  Model name: errorlocate
                     adult           voted    .delta_adult    .delta_voted       
  Minimize               0               0  1.255175949656  1.491239677648       
  r1                    -1               1               0               0  &lt;=  0
  voted                  0               1               0               1   =  1
  adult                 -1               0               1               0   =  0
  Kind                 Std             Std             Std             Std       
  Type                 Int             Int             Int             Int       
  Upper                  1               1               1               1       
  Lower                  0               0               0               0</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">values</span>
<span class="co">#&gt;        adult        voted .delta_adult .delta_voted </span>
<span class="co">#&gt;            1            1            1            0</span></code></pre></div>
</div>
</div>
<div id="conditional-rule" class="section level3">
<h3 class="hasAnchor">
<a href="#conditional-rule" class="anchor"></a>Conditional rule</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu">validator</span><span class="op">(</span> r1 <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">income</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">16</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">12</span>, income <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">age</th>
<th align="right">income</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">12</td>
<td align="right">2000</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect_mip.html">inspect_mip</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">rules</span><span class="op">)</span></code></pre></div>
<p><code>errorlocate</code> encodes this rule into multiple rules (as noted in the theoretical section above), so rule <code>r1</code> is chopped into 1 rule + 2 sub rules:</p>
<p><code>r1: if (income &gt; 0) age &gt;= 16</code>:</p>
<ul>
<li><p><code>r1._lin1: if (r1._lin1 == FALSE) income &lt;= 0</code></p></li>
<li><p><code>r1._lin2: if (r1._lin2 == FALSE) age &gt;= 16</code></p></li>
<li><p><code>r1: r1._lin1 == FALSE | r1._lin2 == FALSE</code></p></li>
</ul>
<p>This can be seen with:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span><span class="op">$</span><span class="fu">mip_rules</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; r1: r1._lin1 + r1._lin2 &lt;= 1</span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; r1._lin1: income - 1e+07*r1._lin1 &lt;= 0</span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; r1._lin2: -age - 1e+07*r1._lin2 &lt;= -16</span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; income_ub: income - 1e+07*.delta_income &lt;= 2000</span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt; age_ub: age - 1e+07*.delta_age &lt;= 12</span>
<span class="co">#&gt; [[6]]</span>
<span class="co">#&gt; income_lb: -income - 1e+07*.delta_income &lt;= -2000</span>
<span class="co">#&gt; [[7]]</span>
<span class="co">#&gt; age_lb: -age - 1e+07*.delta_age &lt;= -12</span></code></pre></div>
<p>The resulting lp model is:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span><span class="op">$</span><span class="fu">to_lp</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>  Model name: errorlocate
                        age          income      .delta_age   .delta_income        r1._lin1        r1._lin2           
  Minimize                0               0  1.011063936166   1.30855324713               0               0           
  r1                      0               0               0               0               1               1  &lt;=      1
  r1._lin1                0               1               0               0          -1e+07               0  &lt;=      0
  r1._lin2               -1               0               0               0               0          -1e+07  &lt;=    -16
  income_ub               0               1               0          -1e+07               0               0  &lt;=   2000
  age_ub                  1               0          -1e+07               0               0               0  &lt;=     12
  income_lb               0              -1               0          -1e+07               0               0  &lt;=  -2000
  age_lb                 -1               0          -1e+07               0               0               0  &lt;=    -12
  Kind                  Std             Std             Std             Std             Std             Std           
  Type                 Real            Real             Int             Int             Int             Int           
  Upper                 Inf             Inf               1               1               1               1           
  Lower                -Inf            -Inf               0               0               0               0</code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">values</span>
<span class="co">#&gt;           age        income    .delta_age .delta_income      r1._lin1 </span>
<span class="co">#&gt;            16          2000             1             0             1 </span>
<span class="co">#&gt;      r1._lin2 </span>
<span class="co">#&gt;             0</span></code></pre></div>
</div>
<div id="alltogether" class="section level3">
<h3 class="hasAnchor">
<a href="#alltogether" class="anchor"></a>Alltogether:</h3>
<p>This works together with categorical, linear and conditional rules.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu">validator</span><span class="op">(</span> r1 <span class="op">=</span> <span class="va">working</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"no_job"</span>, <span class="st">"job"</span>,<span class="st">"retired"</span><span class="op">)</span>
                  , r2 <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">12</span><span class="op">)</span> <span class="va">working</span> <span class="op">==</span> <span class="st">"no_job"</span>
                  , r3 <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">working</span> <span class="op">==</span> <span class="st">"retired"</span><span class="op">)</span> <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">50</span>
                  , r4 <span class="op">=</span> <span class="va">age</span> <span class="op">&gt;=</span><span class="fl">0</span>
                  <span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">12</span>, working<span class="op">=</span><span class="st">"retired"</span><span class="op">)</span>
<span class="va">mip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect_mip.html">inspect_mip</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">rules</span><span class="op">)</span>
<span class="va">mip</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">errors</span>
<span class="co">#&gt; working     age </span>
<span class="co">#&gt;    TRUE   FALSE</span></code></pre></div>
</div>
<div id="weights" class="section level3">
<h3 class="hasAnchor">
<a href="#weights" class="anchor"></a>Weights</h3>
<p>The weights for each variable are normally set to 1, and <code>errorlocate</code> adds some random remainder to the weights: so the solutions are unique and reproducible (using <code>set.seed</code>).</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>
<span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu">validator</span><span class="op">(</span> r1 <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">voted</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="va">adult</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>voted <span class="op">=</span> <span class="cn">TRUE</span>, adult <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">mip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect_mip.html">inspect_mip</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">rules</span>, weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>voted <span class="op">=</span> <span class="fl">3</span>, adult<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><code>$objective</code> contains the generated weights:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span><span class="op">$</span><span class="va">objective</span>
<span class="co">#&gt; .delta_voted .delta_adult </span>
<span class="co">#&gt;     3.457403     1.468538</span></code></pre></div>
<p>These are assigned to the <code>delta</code> variables in the objective function of the mip.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mip</span><span class="op">$</span><span class="fu">to_lp</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>  Model name: errorlocate
                     adult           voted    .delta_adult    .delta_voted       
  Minimize               0               0  1.468537706648  3.457403021748       
  r1                    -1               1               0               0  &lt;=  0
  voted                  0               1               0               1   =  1
  adult                 -1               0               1               0   =  0
  Kind                 Std             Std             Std             Std       
  Type                 Int             Int             Int             Int       
  Upper                  1               1               1               1       
  Lower                  0               0               0               0</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Edwin de Jonge, Mark van der Loo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
